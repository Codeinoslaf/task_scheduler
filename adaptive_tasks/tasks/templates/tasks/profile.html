{% extends 'tasks/base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'tasks/css/profile.css' %}">
{% endblock %}

{% block content %}
<section class="profile">
    <header class="profile-header">
        <div class="profile-title-wrap">
            <h1>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
            <p class="profile-subtitle">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∑–∞–¥–∞—á</p>
        </div>
        <a href="{% url 'calendar' %}" class="btn">
            <span>üìÖ –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—é</span>
        </a>
    </header>

    <div class="profile-grid">
        <a href="{% url 'task_list' %}?filter=all" style="text-decoration: none;">
            <div class="card profile-card">
                <div class="profile-card-icon">üìä</div>
                <div class="profile-card-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                <div class="profile-card-value">{{ total_tasks }}</div>
                <div class="profile-card-description">
                    –°–æ–∑–¥–∞–Ω–æ –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è
                </div>
            </div>
        </a>

        <a href="{% url 'task_list' %}?filter=completed" style="text-decoration: none;">
            <div class="card profile-card">
                <div class="profile-card-icon">‚úÖ</div>
                <div class="profile-card-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                <div class="profile-card-value profile-card-value--success">{{ completed_tasks }}</div>
                <div class="profile-card-description">
                    {% if total_tasks > 0 %}
                    {{ completion_rate }}% –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞
                    {% else %}
                    –ù–∞—á–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏
                    {% endif %}
                </div>
            </div>
        </a>

        <a href="{% url 'task_list' %}?filter=overdue" style="text-decoration: none;">
            <div class="card profile-card">
                <div class="profile-card-icon">‚è∞</div>
                <div class="profile-card-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
                <div class="profile-card-value profile-card-value--danger">
                    {{ overdue_tasks }}
                </div>
                <div class="profile-card-description">
                    –¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è
                </div>
            </div>
        </a>

        <a href="{% url 'task_list' %}?filter=active" style="text-decoration: none;">
            <div class="card profile-card">
                <div class="profile-card-icon">üéØ</div>
                <div class="profile-card-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>
                <div class="profile-card-value profile-card-value--info">{{ active_tasks }}</div>
                <div class="profile-card-description">
                    –í —Ä–∞–±–æ—Ç–µ
                </div>
            </div>
        </a>

        <div class="card profile-card">
            <div class="profile-card-icon">üìà</div>
            <div class="profile-card-label">–°—Ä–µ–¥–Ω–µ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</div>
            <div class="profile-card-value profile-card-value--info">
                {% if avg_delay >= 0 %}+{% endif %}{{ avg_delay }}
            </div>
            <div class="profile-card-description">
                –¥–Ω–µ–π –æ—Ç –¥–µ–¥–ª–∞–π–Ω–∞
            </div>
        </div>

        <div class="card profile-card">
            <div class="profile-card-icon">üíØ</div>
            <div class="profile-card-label">–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
            <div class="profile-card-value profile-card-value--success">{{ completion_rate }}%</div>
            <div class="profile-card-description">
                –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã
            </div>
        </div>
    </div>

    <div class="profile-details">
        <h2>üìã –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div class="details-grid">
            <div class="detail-item">
                <div class="detail-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>
                <div class="detail-value">{{ active_tasks }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">–°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                <div class="detail-value">
                    {% if completion_rate >= 80 %}
                    –û—Ç–ª–∏—á–Ω–æ üåü
                    {% elif completion_rate >= 60 %}
                    –•–æ—Ä–æ—à–æ üëç
                    {% elif completion_rate >= 40 %}
                    –°—Ä–µ–¥–Ω–µ üòê
                    {% else %}
                    –ù—É–∂–Ω–æ –ø–æ—Å—Ç–∞—Ä–∞—Ç—å—Å—è üí™
                    {% endif %}
                </div>
            </div>
            <div class="detail-item">
                <div class="detail-label">–¢–µ–Ω–¥–µ–Ω—Ü–∏—è</div>
                <div class="detail-value">
                    {% if avg_delay < 0 %}
                    –û–ø–µ—Ä–µ–∂–∞–µ—Ç–µ üöÄ
                    {% elif avg_delay == 0 %}
                    –¢–æ—á–Ω–æ –≤ —Å—Ä–æ–∫ ‚è±Ô∏è
                    {% else %}
                    –ï—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ ‚ö†Ô∏è
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="profile-details">
        <h2>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>
        <div style="display: flex; flex-direction: column; gap: 16px; margin-top: 20px;">
            {% if completion_rate < 50 %}
            <div style="padding: 16px; border-radius: 14px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3);">
                <strong style="color: #fca5a5;">‚ö†Ô∏è –ù–∏–∑–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</strong>
                <p style="margin: 8px 0 0; font-size: 14px; color: #cbd5e1;">
                    –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–±–∏–≤–∞—Ç—å –∫—Ä—É–ø–Ω—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å—Ä–æ–∫–∏.
                </p>
            </div>
            {% endif %}

            {% if overdue_tasks > 5 %}
            <div style="padding: 16px; border-radius: 14px; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3);">
                <strong style="color: #fbbf24;">‚è∞ –ú–Ω–æ–≥–æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á</strong>
                <p style="margin: 8px 0 0; font-size: 14px; color: #cbd5e1;">
                    –£–¥–µ–ª–∏—Ç–µ –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á. –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç –∏—Ö –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ.
                </p>
            </div>
            {% endif %}

            {% if avg_delay > 2 %}
            <div style="padding: 16px; border-radius: 14px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3);">
                <strong style="color: #60a5fa;">üìä –ó–∞–¥–µ—Ä–∂–∫–∏ –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏</strong>
                <p style="margin: 8px 0 0; font-size: 14px; color: #cbd5e1;">
                    –í —Å—Ä–µ–¥–Ω–µ–º –≤—ã –∑–∞–≤–µ—Ä—à–∞–µ—Ç–µ –∑–∞–¥–∞—á–∏ —Å –æ–ø–æ–∑–¥–∞–Ω–∏–µ–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–∫–ª–∞–¥—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
                </p>
            </div>
            {% endif %}

            {% if completion_rate >= 80 and avg_delay <= 0 %}
            <div style="padding: 16px; border-radius: 14px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3);">
                <strong style="color: #86efac;">üéâ –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</strong>
                <p style="margin: 8px 0 0; font-size: 14px; color: #cbd5e1;">
                    –í—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å —Å –∑–∞–¥–∞—á–∞–º–∏ –∏ —Å–æ–±–ª—é–¥–∞–µ—Ç–µ –¥–µ–¥–ª–∞–π–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}